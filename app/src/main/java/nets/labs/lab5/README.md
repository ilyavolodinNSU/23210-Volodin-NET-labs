# SOCKS5 Прокси-сервер на Java

Асинхронный SOCKS5 прокси-сервер, реализованный с использованием Java NIO (Non-blocking I/O). Сервер поддерживает асинхронный DNS-резолвинг и проксирование TCP-соединений.

## Особенности

- Полная поддержка протокола SOCKS5
- Асинхронная обработка соединений с использованием Java NIO
- Поддержка IPv4, IPv6 и доменных имен
- Встроенный DNS-резолвер с несколькими DNS-серверами
- Поддержка метода аутентификации NO_AUTH (без аутентификации)
- Логирование с использованием Log4j2
- Пул буферов для эффективной передачи данных

## Структура проекта

```
src/main/java/nets/labs/lab5/
├── Handler.java              # Интерфейс обработчика событий
├── Socks5HandshakeHandler.java # Обработчик рукопожатия SOCKS5
├── ConnectionHandler.java    # Обработчик установки соединений
├── DNSResolver.java          # Асинхронный DNS-резолвер
├── DNSObjects.java           # Обертка для данных DNS-запросов
├── Proxy.java               # Обработчик передачи данных (туннелирование)
├── Socks5Server.java        # Основной класс сервера
└── Main.java                # Точка входа
```

## Зависимости

Проект использует следующие зависимости:

- **Lombok** - для уменьшения шаблонного кода
- **Log4j2** - для логирования
- **dnsjava** - для DNS-резолвинга

## Сборка и запуск

### Требования
- JDK 8 или выше
- Gradle

### Сборка проекта
```bash
./gradlew build
```

### Запуск сервера
```bash
./gradlew run
```

Или напрямую через Java:
```bash
java -jar build/libs/lab5.jar
```

Сервер по умолчанию запускается на `localhost:1080`.

## Конфигурация

### Параметры запуска
- Порт сервера: задается в `Main.java` (по умолчанию 1080)

### DNS-серверы
Сервер использует следующие DNS-серверы (по порядку приоритета):
1. Cloudflare DNS (1.1.1.1:53)
2. Google DNS (8.8.8.8:53)
3. Quad9 DNS (9.9.9.9:53)

## Поддерживаемые функции SOCKS5

### Методы аутентификации
- `0x00` - NO_AUTH (без аутентификации)

### Команды
- `0x01` - CONNECT (установка TCP-соединения)

### Типы адресов
- `0x01` - IPv4
- `0x03` - Доменное имя
- `0x04` - IPv6

## Пример использования

### Настройка клиента
Настройте ваш браузер или приложение на использование SOCKS5 прокси:
- Хост: `localhost`
- Порт: `1080`

### Пример с curl
```bash
curl --socks5-hostname localhost:1080 http://example.com
```

## Логирование

Сервер использует Log4j2 для логирования. Уровни логирования:
- `TRACE` - подробная отладочная информация
- `DEBUG` - отладочная информация
- `INFO` - основная информация о работе
- `WARN` - предупреждения
- `ERROR` - ошибки

## Архитектура

### Основные компоненты
1. **Socks5Server** - основной цикл событий, управление селектором
2. **Socks5HandshakeHandler** - обработка начального рукопожатия SOCKS5
3. **ConnectionHandler** - обработка запросов на соединение
4. **DNSResolver** - асинхронное разрешение доменных имен
5. **Proxy** - туннелирование данных между клиентом и целевым сервером

### Поток данных
1. Клиент устанавливает TCP-соединение с прокси
2. Выполняется рукопожатие SOCKS5
3. Клиент отправляет запрос CONNECT
4. Если указан домен - выполняется DNS-резолвинг
5. Устанавливается соединение с целевым сервером
6. Данные туннелируются между клиентом и сервером

## Отладка

Для отладки используйте следующие методы:

1. Включите DEBUG логирование в Log4j2 конфигурации
2. Мониторинг соединений через логи
3. Тестирование с помощью `telnet` или `nc`

Пример тестирования рукопожатия:
```bash
echo -ne '\x05\x01\x00' | nc localhost 1080
```

## Примечания

- Сервер использует только метод аутентификации NO_AUTH
- Поддерживается только команда CONNECT
- IPv6 поддерживается, но требует соответствующей сетевой конфигурации
- Размер буфера для передачи данных: 32KB

## Безопасность

- Сервер предназначен для использования в доверенной среде
- Не поддерживает шифрование трафика
- Не реализована аутентификация пользователей

## vscode форматирование readme.mdЛицензия

Проект создан в учебных целях.